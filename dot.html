<!doctype html>
<html lang="en">
<head>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400..800;1,400..800&display=swap" rel="stylesheet">
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Duel</title>
<style>
  html,body {
    height:100%; margin:0;
    background:#000;                /* black background */
  }
  svg { width:100vw; height:100vh; display:block; }
  .circle { fill:#fff; transition: fill 0.15s; }  /* white circle */
  .circle.expand { 
    animation: expandEffect 0.4s ease-in-out;
    transform-origin: 50px 50px; /* center of circle: cx=50, cy=50 */
  }
  
  /* Gauge effect for hold duration */
  .gauge-fill {
    fill: #888;
    transform-origin: center;
    transform: scale(0);
    transition: transform 0.1s ease-out;
  }
  
  .gauge-fill.filling {
    transition: transform 0.25s linear;
    transform: scale(1);
  }
  
  .gauge-fill.filled {
    transform: scale(1);
    transition: none;
  }
  
  .gauge-fill.shrinking {
    transition: transform 0.15s ease-in;
    transform: scale(0);
  }
  
  /* Congratulations message styling */
  .congrats-text {
    fill: #fff;
    font-family: "EB Garamond", serif;
    font-weight: 700;
    text-anchor: start;
    dominant-baseline: hanging;
  }
  
  /* Expand animation */
  .expand {
    animation: expandEffect 0.4s ease-in-out;
  }
  
  @keyframes expandEffect {
    0% { transform: scale(1); }
    50% { transform: scale(1.3); }
    100% { transform: scale(1); }
  }
  
  /* Delayed text that appears after 2 seconds */
  .delayed-text {
    opacity: 0;
    transition: opacity 1s ease-in-out;
  }
  
  .delayed-text.show {
    opacity: 1;
  }
</style>
</head>
<body>
<svg viewBox="0 0 100 100" preserveAspectRatio="xMidYMid meet">
  <!-- Congratulations message in top-left corner -->
  <text x="-20" y="8" 
        font-size="6" 
        class="congrats-text">
    Well done!
  </text>
  <text x="-20" y="18" 
        font-size="6" 
        class="congrats-text">
    Simply click and it's a DOT
  </text>
  
  <text x="14" y="78" 
        font-size="6" 
        class="congrats-text delayed-text"
        id="dashInstruction">
    Now try holding for a DASH
  </text>

  <!-- centered circle -->
  <circle id="dotCircle" class="circle" cx="50" cy="50" r="16"/>
  <!-- Gauge fill that grows during hold -->
  <circle id="gaugeFill" class="gauge-fill" cx="50" cy="50" r="16"/>
</svg>

<script>
  let pressStart = null;
  let navigating = false;               // prevent double redirects
  const THRESHOLD = 250;                // < 250ms = dot, >= 250ms = dash
  const FLASH_MS  = 500;
  const dashRedirect = () => location.href = "dash.html";

  const circle = document.getElementById('dotCircle');
  const gaugeFill = document.getElementById('gaugeFill');
  
  // Show delayed text after 1.5 seconds
  setTimeout(() => {
    const dashInstruction = document.getElementById('dashInstruction');
    dashInstruction.classList.add('show');
  }, 1500);

  function startGaugeEffect() {
    gaugeFill.classList.remove('shrinking', 'filled');
    gaugeFill.classList.add('filling');
    
    // After 250ms, switch to filled state (no transition, stays at scale(1))
    setTimeout(() => {
      if (pressStart !== null) { // Only if still pressing
        gaugeFill.classList.remove('filling');
        gaugeFill.classList.add('filled');
      }
    }, 250);
  }

  function stopGaugeEffect() {
    gaugeFill.classList.remove('filling', 'filled');
    gaugeFill.classList.add('shrinking');
  }

  function handleSignal(duration){
    if (navigating) return;
    if (duration < THRESHOLD) {
      // DOT: add expand effect and prompt user to hold longer
      circle.classList.add('expand');
      setTimeout(() => circle.classList.remove('expand'), 400);
      
      const dashInstruction = document.getElementById('dashInstruction');
      
      // Fade out
      dashInstruction.style.opacity = '0';
      
      // Change text after fade out completes
      setTimeout(() => {
        dashInstruction.textContent = 'Hold a little longer for DASH';
        // Fade back in
        dashInstruction.style.opacity = '1';
      }, 700);
      
    } else {
      // DASH: keep gauge filled, redirect to dash.html
      navigating = true;
      // Don't call stopGaugeEffect() - keep the grey area filled
      setTimeout(() => dashRedirect(), FLASH_MS);
    }
  }

  // Keyboard (Enter)
  window.addEventListener("keydown", e => {
    if (e.code === "Enter" && pressStart === null) {
      pressStart = Date.now();
      startGaugeEffect();
      e.preventDefault();
    }
  });
  window.addEventListener("keyup", e => {
    if (e.code === "Enter" && pressStart !== null) {
      const duration = Date.now() - pressStart;
      pressStart = null;
      // Only shrink gauge if it was a DOT (< 250ms)
      if (duration < THRESHOLD) {
        stopGaugeEffect();
      }
      handleSignal(duration);
      e.preventDefault();
    }
  });

  // Mouse (left click/hold)
  window.addEventListener("mousedown", e => {
    if (e.button === 0 && pressStart === null) {
      pressStart = Date.now();
      startGaugeEffect();
    }
  });
  window.addEventListener("mouseup", e => {
    if (e.button === 0 && pressStart !== null) {
      const duration = Date.now() - pressStart;
      pressStart = null;
      // Only shrink gauge if it was a DOT (< 250ms)
      if (duration < THRESHOLD) {
        stopGaugeEffect();
      }
      handleSignal(duration);
    }
  });

  // Touch (tap/hold)
  window.addEventListener("touchstart", () => {
    if (pressStart === null) {
      pressStart = Date.now();
      startGaugeEffect();
    }
  }, { passive: true });
  window.addEventListener("touchend", () => {
    if (pressStart !== null) {
      const duration = Date.now() - pressStart;
      pressStart = null;
      // Only shrink gauge if it was a DOT (< 250ms)
      if (duration < THRESHOLD) {
        stopGaugeEffect();
      }
      handleSignal(duration);
    }
  });
</script>
</body>
</html>